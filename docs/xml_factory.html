<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XML - YASMIN</title>
    <link rel="stylesheet" href="style.css">
    <script src="sidebar.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script src="dark_mode.js"></script>
</head>
<body>
    <header>
        <a href="index.html" class="logo">
            <img src="logo.png" alt="YASMIN Logo">
            YASMIN
        </a>
        <div class="nav-links">
            <a href="index.html">Docs</a>
            <a href="https://github.com/uleroboticsgroup/yasmin" target="_blank">GitHub</a>
            <a href="doxygen.html" target="_blank">Doxygen</a>
            <button id="theme-toggle" title="Toggle Dark Mode">üåô</button>
        </div>
    </header>

    <div class="container">
                <nav class="sidebar">
            <h3>Getting Started</h3>
            <ul>
                <li><a href="index.html">Introduction</a></li>
                <li><a href="main_concepts.html">Main Concepts</a></li>
                <li><a href="packages.html">Packages Overview</a></li>
                <li><a href="docker.html">Docker</a></li>
                <li><a href="xml_factory.html">XML</a></li>
            </ul>
            
            <h3>Tutorials</h3>
            <ul>
                <li><a href="tutorials.html">All Tutorials</a></li>
            </ul>

            <h3 class="collapsible">C++ Tutorials</h3>
            <ul>
                <li><a href="tutorials/cpp/basic_fsm.html">Writing a Simple FSM</a></li>
                <li><a href="tutorials/cpp/remap_demo.html">Blackboard Remapping</a></li>
                <li><a href="tutorials/cpp/concurrence_demo.html">Concurrence</a></li>
                <li><a href="tutorials/cpp/service_client_demo.html">Service Client</a></li>
                <li><a href="tutorials/cpp/action_client_demo.html">Action Client</a></li>
                <li><a href="tutorials/cpp/monitor_demo.html">Monitor (Subscriber)</a></li>
                <li><a href="tutorials/cpp/publisher_demo.html">Publisher</a></li>
                <li><a href="tutorials/cpp/parameters_demo.html">ROS Parameters</a></li>
                <li><a href="tutorials/cpp/nav2_demo.html">Nav2 Demo</a></li>
                <li><a href="tutorials/cpp/factory_demo.html">Factory (XML)</a></li>
            </ul>

            <h3 class="collapsible">Python Tutorials</h3>
            <ul>
                <li><a href="tutorials/python/basic_fsm.html">Writing a Simple FSM</a></li>
                <li><a href="tutorials/python/remap_demo.html">Blackboard Remapping</a></li>
                <li><a href="tutorials/python/concurrence_demo.html">Concurrence</a></li>
                <li><a href="tutorials/python/service_client_demo.html">Service Client</a></li>
                <li><a href="tutorials/python/action_client_demo.html">Action Client</a></li>
                <li><a href="tutorials/python/monitor_demo.html">Monitor (Subscriber)</a></li>
                <li><a href="tutorials/python/publisher_demo.html">Publisher</a></li>
                <li><a href="tutorials/python/parameters_demo.html">ROS Parameters</a></li>
                <li><a href="tutorials/python/nav2_demo.html">Nav2 Demo</a></li>
                <li><a href="tutorials/python/factory_demo.html">Factory (XML)</a></li>
            </ul>
            
            <h3>Tools</h3>
            <ul>
                <li><a href="yasmin_editor.html">YASMIN Editor</a></li>
                <li><a href="yasmin_factory.html">YASMIN Factory</a></li>
                <li><a href="yasmin_viewer.html">YASMIN Viewer</a></li>
            </ul>

            <h3>Resources</h3>
            <ul>
                <li><a href="citations.html">Citations</a></li>
            </ul>
        </nav>

        <main class="main-content content">
            <h1>XML-Based State Machine Definition</h1>
            <p>YASMIN Factory allows you to define state machines using XML files, enabling configuration without code changes. This is particularly useful for:</p>
            <ul>
                <li><strong>Rapid prototyping:</strong> Test different behaviors quickly</li>
                <li><strong>Non-programmer friendly:</strong> Modify robot behaviors without coding</li>
                <li><strong>Version control:</strong> Track state machine structures easily</li>
                <li><strong>Runtime flexibility:</strong> Load different behaviors dynamically</li>
            </ul>

            <h2>XML Structure</h2>
            <p>A YASMIN XML state machine definition includes state declarations, transitions, and optional remapping. The example below shows a simple state machine with two states:</p>
            <ul>
                <li><strong>StateMachine element:</strong> Root container with <code>id</code> and <code>default_outcome</code> attributes</li>
                <li><strong>State elements:</strong> Define individual states with their type (<code>py</code> or <code>cpp</code>), module/class information</li>
                <li><strong>Transition elements:</strong> Specify how states connect - which outcome leads to which target state</li>
                <li><strong>Self-loops:</strong> Notice <code>state1</code> can transition back to itself on <code>fail</code> outcome, useful for retry logic</li>
            </ul>
            
            <pre><code class="language-xml">&lt;StateMachine id="example_sm" default_outcome="finish"&gt;
    &lt;State id="state1" type="py" module="my_package.states" class="MyState"&gt;
        &lt;Transition outcome="success" target="state2"/&gt;
        &lt;Transition outcome="fail" target="state1"/&gt;
    &lt;/State&gt;
    
    &lt;State id="state2" type="py" module="my_package.states" class="AnotherState"&gt;
        &lt;Transition outcome="done" target="finish"/&gt;
    &lt;/State&gt;
&lt;/StateMachine&gt;</code></pre>

            <h2>State Types</h2>
            <p>YASMIN Factory supports both Python and C++ states in the same state machine, enabling you to leverage existing code in either language or mix implementations based on performance needs and developer expertise. The factory automatically handles the language-specific loading and instantiation mechanisms.</p>

            <div class="info-box" style="background: linear-gradient(135deg, #fff3cd 0%, #ffe69c 100%); border-left: 4px solid #ffc107; padding: 15px; margin: 20px 0; color: #000;">
                <strong style="color: #856404;">‚ö†Ô∏è Important - Cross-Language Communication:</strong>
                <p style="color: #856404;">When mixing Python and C++ states in the same state machine, they can communicate through the blackboard, but <strong>only with primitive data types</strong>:</p>
                <ul style="margin: 10px 0 0 20px; color: #856404;">
                    <li><code style="background-color: rgba(0,0,0,0.1); color: #000; padding: 2px 4px; border-radius: 3px;">int</code> - Integer numbers</li>
                    <li><code style="background-color: rgba(0,0,0,0.1); color: #000; padding: 2px 4px; border-radius: 3px;">float</code> - Floating-point numbers</li>
                    <li><code style="background-color: rgba(0,0,0,0.1); color: #000; padding: 2px 4px; border-radius: 3px;">bool</code> - Boolean values</li>
                    <li><code style="background-color: rgba(0,0,0,0.1); color: #000; padding: 2px 4px; border-radius: 3px;">string</code> - Text strings</li>
                </ul>
                <p style="margin-top: 10px; color: #856404;">Complex objects, custom classes, or ROS messages cannot be directly shared between Python and C++ states through the blackboard.</p>
            </div>

            <h3>Python States</h3>
            <p>Python states are loaded dynamically from the specified module and class. The <code>type="py"</code> attribute tells the factory to use Python's import system to locate and instantiate the state class.</p>
            <pre><code class="language-xml">&lt;State id="python_state" type="py" module="my_package.states" class="MyPythonState"&gt;
    &lt;Transition outcome="success" target="next_state"/&gt;
&lt;/State&gt;</code></pre>

            <h3>C++ States</h3>
            <p>C++ states use ROS 2's pluginlib system for dynamic loading. The <code>type="cpp"</code> attribute indicates that the state should be loaded as a plugin, with the class name following the <code>package_name/ClassName</code> convention used by pluginlib.</p>
            <pre><code class="language-xml">&lt;State id="cpp_state" type="cpp" class="my_package/MyCppState"&gt;
    &lt;Transition outcome="success" target="next_state"/&gt;
&lt;/State&gt;</code></pre>

            <h2>Loading XML State Machines</h2>
            <p>Once you've defined your state machine in XML, the YASMIN Factory API provides simple methods to load and execute it. The factory handles all the parsing, state instantiation, and wiring of transitions automatically.</p>
            
            <h3>Python</h3>
            <p>In Python, create a factory instance and use <code>create_sm_from_file()</code> to load the XML definition. The returned state machine can be executed directly by calling it as a function.</p>
            <pre><code class="language-python">from yasmin_factory import YasminFactory

factory = YasminFactory()
sm = factory.create_sm_from_file("path/to/state_machine.xml")

# Execute the state machine
outcome = sm()
print(outcome)</code></pre>

            <h3>C++</h3>
            <p>The C++ API mirrors the Python interface. Include the factory header, create a factory instance, and load the XML file. The state machine is returned as a shared pointer that can be dereferenced and executed.</p>
            <pre><code class="language-cpp">#include "yasmin_factory/yasmin_factory.hpp"

yasmin_factory::YasminFactory factory;
auto sm = factory.create_sm_from_file("path/to/state_machine.xml");

// Execute the state machine
std::string outcome = (*sm.get())();
YASMIN_LOG_INFO(outcome.c_str());</code></pre>

            <h2>Advanced Features</h2>
            <p>YASMIN Factory supports advanced state machine patterns through XML configuration, enabling complex behaviors without modifying code. These features include data remapping, hierarchical composition, and parallel execution.</p>
            
            <h3>Blackboard Remapping</h3>
            <p>Remapping allows you to connect state inputs and outputs to different blackboard keys, making states more reusable. This is essential when using generic states in different contexts or when multiple instances of the same state need to access different data.</p>
            <pre><code class="language-xml">&lt;State id="my_state" type="py" module="pkg.states" class="MyState"&gt;
    &lt;Remap from="input_data" to="sensor_reading"/&gt;
    &lt;Remap from="output_data" to="processed_result"/&gt;
    &lt;Transition outcome="success" target="next_state"/&gt;
&lt;/State&gt;</code></pre>

            <h3>Nested State Machines</h3>
            <p>Hierarchical state machines allow you to organize complex behaviors into manageable sub-machines. A nested state machine appears as a single state to its parent, with its internal outcomes mapped to transitions in the outer machine. This promotes modularity and reusability of behavior patterns.</p>
            <pre><code class="language-xml">&lt;StateMachine id="main_sm" default_outcome="done"&gt;
    &lt;StateMachine id="sub_sm" default_outcome="sub_done"&gt;
        &lt;State id="sub_state1" type="py" module="pkg" class="State1"/&gt;
        &lt;State id="sub_state2" type="py" module="pkg" class="State2"/&gt;
    &lt;/StateMachine&gt;
    
    &lt;Transition from="sub_sm" outcome="sub_done" target="done"/&gt;
&lt;/StateMachine&gt;</code></pre>

            <h3>Concurrence States</h3>
            <p>Concurrence states execute multiple child states simultaneously in parallel threads. The outcome mapping defines which combination of child outcomes determines the overall concurrence outcome. This is useful for implementing behaviors that monitor multiple conditions simultaneously or execute independent tasks in parallel for efficiency.</p>
            <pre><code class="language-xml">&lt;Concurrence id="concurrent_states" default_outcome="defaulted"&gt;
    &lt;State id="state_a" type="py" module="pkg" class="StateA"/&gt;
    &lt;State id="state_b" type="py" module="pkg" class="StateB"/&gt;
    
    &lt;OutcomeMap outcome="all_done"&gt;
        &lt;StateOutcome state="state_a" outcome="success"/&gt;
        &lt;StateOutcome state="state_b" outcome="success"/&gt;
    &lt;/OutcomeMap&gt;
&lt;/Concurrence&gt;</code></pre>

            <h2>Example: Mixed Language State Machine</h2>
            <p>This example demonstrates a state machine using both Python and C++ states:</p>
            <pre><code class="language-xml">&lt;StateMachine outcomes="outcome4"&gt;
    &lt;State name="Foo" type="cpp" class="yasmin_demos/FooState"&gt;
        &lt;Transition from="outcome1" to="Bar"/&gt;
        &lt;Transition from="outcome2" to="outcome4"/&gt;
    &lt;/State&gt;
    &lt;State name="Bar" type="py" module="yasmin_demos.bar_state" class="BarState"&gt;
        &lt;Transition from="outcome3" to="Foo"/&gt;
    &lt;/State&gt;
&lt;/StateMachine&gt;</code></pre>

            <h2>See Also</h2>
            <ul>
                <li><a href="yasmin_factory.html">YASMIN Factory Tool Documentation</a></li>
                <li><a href="tutorials/python/factory_demo.html">Factory Demo Tutorial (Python)</a></li>
                <li><a href="https://github.com/uleroboticsgroup/yasmin/tree/main/yasmin_demos/state_machines" target="_blank">Example XML Files on GitHub</a></li>
            </ul>
        </main>
    </div>

    <footer>
        <p>&copy; 2025 YASMIN Project. Licensed under GPL v3.0. | Documentation generated with <a href="doxygen.html" target="_blank">Doxygen</a></p>
    </footer>
</body>
</html>